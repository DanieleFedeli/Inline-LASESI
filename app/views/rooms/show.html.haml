-provide(:title, @room.name)
%br
.container-fluid{:style => 'padding-left: 15%; padding-right: 15%;'}
	.page-header.media
		.media-body
			%h3.text-center.my-3
				=@room.name
			 
			%p.text-center
				=@room.description
			
	.row
		.col-3.border-right
			%h4.text-center.my-auto.border-bottom
				Info
			-if !has_no_location
				.row#map.mx-auto{:style=>'width: 100%; height: 200px; margin: 5%;'}
				%label
					Address:
				=@room.address
			
			
			%label.mx-auto
				Da:
			%input.text-center#dateEvent_from{:type => 'text'}
			%br
			%label.mx-auto
				A:
			%input.text-center#dateEvent_to{:type => 'text'}
			
			%h4.text-center.my-3

				Room host:
				
				%table.table
					%tbody
					-@room.powers.each do |p|
						%tr
							%td.text-center
								=link_to p.user.username, user_path(p.user)   
		.col-6
			%h4.text-center.my-auto.border-bottom
				CODA
			%ul.list-group.userlist#userlist{:style => 'padding-top: 10px;'}
			
			-if @room.fifo
				#joindiv{:style => 'margin-top: 10px;'}
					-if can_i_reserve?
						-if can_delete?
							=render 'join'
						-else
							%button.btn.btn-danger.btn-lg{:disabled => ''}
								Tempo scaduto!
					-else
						-if do_i_have_powers?
							%button.btn.btn-danger.btn-lg{:disabled => ''} 
								You have powers!
						-else
							=render 'unjoin' 
				#reminderdiv{:style => 'margin-top: 10px'}
					-if !current_user.nil? && current_user.reservations.exists?(room_id: @room.id)
						=render 'remind' 
		.col-3.border-left
			%h4.text-center.my-auto.border-bottom
				CHAT
			.div{:style=>"overflow-y:scroll; height: 60%;"}
				-@room.messages.each do |m|	
					%p
						%strong 
							=link_to User.find(m.user_id).username, user_path(m.user) 
						=m.body
			-if current_user
				= form_for([@room, Message.new], remote: true) do |f|
					= hidden_field_tag :user_id, current_user.id
					.input-group.mb-3
						=f.text_field :body, class: "form-control",placeholder: "Insert your message...", autocomplete: "off",id:"chat_input"
						.input-group-append
							= f.button "Invia", class: "btn btn-primary btn-block"
			-else
				.input-group.mb-3
					%input#chat_input{:type => 'text', :placeholder => 'Insert your message...', :autocomplete => 'off'}
					.input-group-append
						%button.btn.btn-primary.btn-block{:disabled => ''}
							Disabled
					%small
						Log in and join the queue first!
:javascript
	var url = getRightUrl();
	setRightUrl();

	$(document).ready(function(){	
		refreshingPartial();
		getParticipants();
		var room_json = init(url+'.json');
		
		var dateFrom = $("#dateEvent_from").flatpickr({ 
			enableTime: true,
			altInput: true,
			altFromat: "F j, Y",
			dateFormat: 'Y-m-d H:i',
			minDate: room_json.time_from,
			maxDate: room_json.time_from,
			defaultDate: room_json.time_from,
		});
		
		var dateFrom = $("#dateEvent_to").flatpickr({ 
			enableTime: true,
			altInput: true,
			altFromat: "F j, Y",
			dateFormat: 'Y-m-d H:i',
			minDate: room_json.time_to,
			maxDate: room_json.time_to,
			defaultDate: room_json.time_to
		})

		if($('#map').length) {      
			render_map_for_room_show(url+'.json');
			$('.marker').hide();
		}
	});
	
	function getParticipants(){
		setTimeout(function(){
			refreshingPartial();
			getParticipants();
		}, 5000);

	}	
	function refreshingPartial(){
		setTimeout(function(){
			$('#userlist').load(url+'/reservations')
		}, 200);
	}

	function setRightUrl(){
		if(document.URL.substr(-1) == '#') window.location = document.URL.slice(0,-1);
	}